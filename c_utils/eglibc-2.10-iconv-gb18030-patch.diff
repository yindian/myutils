--- gb18030.c.orig	2006-08-17 10:18:26.000000000 +0900
+++ gb18030.c	2011-01-10 05:40:51.000000000 +0900
@@ -6109,7 +6109,7 @@
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 */
 
-static const uint16_t __fourbyte_to_ucs[39419-11172-4295] =
+static uint16_t __fourbyte_to_ucs[39419-11172-4295+1] =
 {
   [0x0000] = 0x0080, [0x0001] = 0x0081, [0x0002] = 0x0082, [0x0003] = 0x0083,
   [0x0004] = 0x0084, [0x0005] = 0x0085, [0x0006] = 0x0086, [0x0007] = 0x0087,
@@ -6275,7 +6275,7 @@
   [0x02c8] = 0x0374, [0x02c9] = 0x0375, [0x02ce] = 0x037a, [0x02d2] = 0x037e,
   [0x02d8] = 0x0384, [0x02d9] = 0x0385, [0x02da] = 0x0386, [0x02db] = 0x0387,
   [0x02dc] = 0x0388, [0x02dd] = 0x0389, [0x02de] = 0x038a, [0x02e0] = 0x038c,
-  [0x02e2] = 0x038e, [0x02e3] = 0x038f, [0x02e4] = 0x0390, [0x02e6] = 0x03aa,
+  [0x02e2] = 0x038e, [0x02e3] = 0x038f, [0x02e4] = 0x0390, [0x02e5] = 0x03a2, [0x02e6] = 0x03aa,
   [0x02e7] = 0x03ab, [0x02e8] = 0x03ac, [0x02e9] = 0x03ad, [0x02ea] = 0x03ae,
   [0x02eb] = 0x03af, [0x02ec] = 0x03b0, [0x02ed] = 0x03c2, [0x02ee] = 0x03ca,
   [0x02ef] = 0x03cb, [0x02f0] = 0x03cc, [0x02f1] = 0x03cd, [0x02f2] = 0x03ce,
@@ -7407,7 +7407,7 @@
   [0x202b] = 0x215f, [0x202c] = 0x216c, [0x202d] = 0x216d, [0x202e] = 0x216e,
   [0x202f] = 0x216f, [0x2030] = 0x217a, [0x2031] = 0x217b, [0x2032] = 0x217c,
   [0x2033] = 0x217d, [0x2034] = 0x217e, [0x2035] = 0x217f, [0x2036] = 0x2180,
-  [0x2037] = 0x2181, [0x2038] = 0x2182, [0x2039] = 0x2183, [0x2046] = 0x2194,
+  [0x2037] = 0x2181, [0x2038] = 0x2182, [0x2039] = 0x2183, [0x2045] = 0x218f, [0x2046] = 0x2194,
   [0x2047] = 0x2195, [0x2048] = 0x219a, [0x2049] = 0x219b, [0x204a] = 0x219c,
   [0x204b] = 0x219d, [0x204c] = 0x219e, [0x204d] = 0x219f, [0x204e] = 0x21a0,
   [0x204f] = 0x21a1, [0x2050] = 0x21a2, [0x2051] = 0x21a3, [0x2052] = 0x21a4,
@@ -7552,7 +7552,7 @@
   [0x22ac] = 0x2424, [0x22ad] = 0x2425, [0x22ae] = 0x2426, [0x22c8] = 0x2440,
   [0x22c9] = 0x2441, [0x22ca] = 0x2442, [0x22cb] = 0x2443, [0x22cc] = 0x2444,
   [0x22cd] = 0x2445, [0x22ce] = 0x2446, [0x22cf] = 0x2447, [0x22d0] = 0x2448,
-  [0x22d1] = 0x2449, [0x22d2] = 0x244a, [0x22e8] = 0x246a, [0x22e9] = 0x246b,
+  [0x22d1] = 0x2449, [0x22d2] = 0x244a, [0x22e7] = 0x245f, [0x22e8] = 0x246a, [0x22e9] = 0x246b,
   [0x22ea] = 0x246c, [0x22eb] = 0x246d, [0x22ec] = 0x246e, [0x22ed] = 0x246f,
   [0x22ee] = 0x2470, [0x22ef] = 0x2471, [0x22f0] = 0x2472, [0x22f1] = 0x2473,
   [0x22f2] = 0x249c, [0x22f3] = 0x249d, [0x22f4] = 0x249e, [0x22f5] = 0x249f,
@@ -7579,7 +7579,7 @@
   [0x2346] = 0x24f0, [0x2347] = 0x24f1, [0x2348] = 0x24f2, [0x2349] = 0x24f3,
   [0x234a] = 0x24f4, [0x234b] = 0x24f5, [0x234c] = 0x24f6, [0x234d] = 0x24f7,
   [0x234e] = 0x24f8, [0x234f] = 0x24f9, [0x2350] = 0x24fa, [0x2351] = 0x24fb,
-  [0x2352] = 0x24fc, [0x2353] = 0x24fd, [0x2354] = 0x24fe, [0x2356] = 0x254c,
+  [0x2352] = 0x24fc, [0x2353] = 0x24fd, [0x2354] = 0x24fe, [0x2355] = 0x24ff, [0x2356] = 0x254c,
   [0x2357] = 0x254d, [0x2358] = 0x254e, [0x2359] = 0x254f, [0x235a] = 0x2574,
   [0x235b] = 0x2575, [0x235c] = 0x2576, [0x235d] = 0x2577, [0x235e] = 0x2578,
   [0x235f] = 0x2579, [0x2360] = 0x257a, [0x2361] = 0x257b, [0x2362] = 0x257c,
@@ -7964,18 +7964,19 @@
   [0x2d79] = 0x2fc7, [0x2d7a] = 0x2fc8, [0x2d7b] = 0x2fc9, [0x2d7c] = 0x2fca,
   [0x2d7d] = 0x2fcb, [0x2d7e] = 0x2fcc, [0x2d7f] = 0x2fcd, [0x2d80] = 0x2fce,
   [0x2d81] = 0x2fcf, [0x2d82] = 0x2fd0, [0x2d83] = 0x2fd1, [0x2d84] = 0x2fd2,
-  [0x2d85] = 0x2fd3, [0x2d86] = 0x2fd4, [0x2d87] = 0x2fd5, [0x2da6] = 0x3004,
+  [0x2d85] = 0x2fd3, [0x2d86] = 0x2fd4, [0x2d87] = 0x2fd5,
+  [0x2da1] = 0x2fef, [0x2da2] = 0x2ffc, [0x2da5] = 0x2fff, [0x2da6] = 0x3004,
   [0x2da7] = 0x3018, [0x2da8] = 0x3019, [0x2da9] = 0x301a, [0x2daa] = 0x301b,
   [0x2dab] = 0x301c, [0x2dac] = 0x301f, [0x2dad] = 0x3020, [0x2dae] = 0x302a,
   [0x2daf] = 0x302b, [0x2db0] = 0x302c, [0x2db1] = 0x302d, [0x2db2] = 0x302e,
   [0x2db3] = 0x302f, [0x2db4] = 0x3030, [0x2db5] = 0x3031, [0x2db6] = 0x3032,
   [0x2db7] = 0x3033, [0x2db8] = 0x3034, [0x2db9] = 0x3035, [0x2dba] = 0x3036,
   [0x2dbb] = 0x3037, [0x2dbc] = 0x3038, [0x2dbd] = 0x3039, [0x2dbe] = 0x303a,
-  [0x2dbf] = 0x303b, [0x2dc0] = 0x303c, [0x2dc1] = 0x303d, [0x2dc2] = 0x303f,
+  [0x2dbf] = 0x303b, [0x2dc0] = 0x303c, [0x2dc1] = 0x303d, [0x2dc2] = 0x303f, [0x2dc3] = 0x3040,
   [0x2dc4] = 0x3094, [0x2dc5] = 0x3095, [0x2dc6] = 0x3096, [0x2dc9] = 0x3099,
   [0x2dca] = 0x309a, [0x2dcb] = 0x309f, [0x2dcc] = 0x30a0, [0x2dcd] = 0x30f7,
   [0x2dce] = 0x30f8, [0x2dcf] = 0x30f9, [0x2dd0] = 0x30fa, [0x2dd1] = 0x30fb,
-  [0x2dd2] = 0x30ff, [0x2dd8] = 0x312a, [0x2dd9] = 0x312b, [0x2dda] = 0x312c,
+  [0x2dd2] = 0x30ff, [0x2dd7] = 0x3104, [0x2dd8] = 0x312a, [0x2dd9] = 0x312b, [0x2dda] = 0x312c,
   [0x2ddf] = 0x3131, [0x2de0] = 0x3132, [0x2de1] = 0x3133, [0x2de2] = 0x3134,
   [0x2de3] = 0x3135, [0x2de4] = 0x3136, [0x2de5] = 0x3137, [0x2de6] = 0x3138,
   [0x2de7] = 0x3139, [0x2de8] = 0x313a, [0x2de9] = 0x313b, [0x2dea] = 0x313c,
@@ -8020,7 +8021,7 @@
   [0x2ebc] = 0x320e, [0x2ebd] = 0x320f, [0x2ebe] = 0x3210, [0x2ebf] = 0x3211,
   [0x2ec0] = 0x3212, [0x2ec1] = 0x3213, [0x2ec2] = 0x3214, [0x2ec3] = 0x3215,
   [0x2ec4] = 0x3216, [0x2ec5] = 0x3217, [0x2ec6] = 0x3218, [0x2ec7] = 0x3219,
-  [0x2ec8] = 0x321a, [0x2ec9] = 0x321b, [0x2eca] = 0x321c, [0x2ece] = 0x322a,
+  [0x2ec8] = 0x321a, [0x2ec9] = 0x321b, [0x2eca] = 0x321c, [0x2ecd] = 0x321f, [0x2ece] = 0x322a,
   [0x2ecf] = 0x322b, [0x2ed0] = 0x322c, [0x2ed1] = 0x322d, [0x2ed2] = 0x322e,
   [0x2ed3] = 0x322f, [0x2ed4] = 0x3230, [0x2ed5] = 0x3232, [0x2ed6] = 0x3233,
   [0x2ed7] = 0x3234, [0x2ed8] = 0x3235, [0x2ed9] = 0x3236, [0x2eda] = 0x3237,
@@ -9760,7 +9761,8 @@
   [0x4a0b] = 0x4da7, [0x4a0c] = 0x4da8, [0x4a0d] = 0x4da9, [0x4a0e] = 0x4daa,
   [0x4a0f] = 0x4dab, [0x4a10] = 0x4dac, [0x4a11] = 0x4dad, [0x4a12] = 0x4daf,
   [0x4a13] = 0x4db0, [0x4a14] = 0x4db1, [0x4a15] = 0x4db2, [0x4a16] = 0x4db3,
-  [0x4a17] = 0x4db4, [0x4a18] = 0x4db5, [0x4abd] = 0xa000, [0x4abe] = 0xa001,
+  [0x4a17] = 0x4db4, [0x4a18] = 0x4db5, [0x4a62] = 0x4dff, [0x4a63] = 0x9fa6,
+                                        [0x4abd] = 0xa000, [0x4abe] = 0xa001,
   [0x4abf] = 0xa002, [0x4ac0] = 0xa003, [0x4ac1] = 0xa004, [0x4ac2] = 0xa005,
   [0x4ac3] = 0xa006, [0x4ac4] = 0xa007, [0x4ac5] = 0xa008, [0x4ac6] = 0xa009,
   [0x4ac7] = 0xa00a, [0x4ac8] = 0xa00b, [0x4ac9] = 0xa00c, [0x4aca] = 0xa00d,
@@ -10065,7 +10067,7 @@
   [0x4f76] = 0xa4b9, [0x4f77] = 0xa4ba, [0x4f78] = 0xa4bb, [0x4f79] = 0xa4bc,
   [0x4f7a] = 0xa4bd, [0x4f7b] = 0xa4be, [0x4f7c] = 0xa4bf, [0x4f7d] = 0xa4c0,
   [0x4f7e] = 0xa4c1, [0x4f7f] = 0xa4c2, [0x4f80] = 0xa4c3, [0x4f81] = 0xa4c4,
-  [0x4f82] = 0xa4c5, [0x4f83] = 0xa4c6, [0x5719] = 0xe76c, [0x571a] = 0xe7c8,
+  [0x4f82] = 0xa4c5, [0x4f83] = 0xa4c6, [0x56bc] = 0xabff, [0x56bd] = 0xd7a4, [0x5718] = 0xd7ff, [0x5719] = 0xe76c, [0x571a] = 0xe7c8,
   [0x571b] = 0xe7e7, [0x571c] = 0xe7e8, [0x571d] = 0xe7e9, [0x571e] = 0xe7ea,
   [0x571f] = 0xe7eb, [0x5720] = 0xe7ec, [0x5721] = 0xe7ed, [0x5722] = 0xe7ee,
   [0x5723] = 0xe7ef, [0x5724] = 0xe7f0, [0x5725] = 0xe7f1, [0x5726] = 0xe7f2,
@@ -10327,8 +10329,9 @@
   [0x5c2e] = 0xfe05, [0x5c2f] = 0xfe06, [0x5c30] = 0xfe07, [0x5c31] = 0xfe08,
   [0x5c32] = 0xfe09, [0x5c33] = 0xfe0a, [0x5c34] = 0xfe0b, [0x5c35] = 0xfe0c,
   [0x5c36] = 0xfe0d, [0x5c37] = 0xfe0e, [0x5c38] = 0xfe0f, [0x5c49] = 0xfe20,
-  [0x5c4a] = 0xfe21, [0x5c4b] = 0xfe22, [0x5c4c] = 0xfe23, [0x5c59] = 0xfe32,
-  [0x5c5a] = 0xfe45, [0x5c5b] = 0xfe46, [0x5c5f] = 0xfe58, [0x5c65] = 0xfe70,
+  [0x5c4a] = 0xfe21, [0x5c4b] = 0xfe22, [0x5c4c] = 0xfe23, [0x5c58] = 0xfe2f, [0x5c59] = 0xfe32,
+  [0x5c5a] = 0xfe45, [0x5c5b] = 0xfe46, [0x5c5d] = 0xfe48, [0x5c5e] = 0xfe53,
+  [0x5c5f] = 0xfe58, [0x5c60] = 0xfe67, [0x5c61] = 0xfe6c, [0x5c65] = 0xfe70,
   [0x5c66] = 0xfe71, [0x5c67] = 0xfe72, [0x5c68] = 0xfe73, [0x5c69] = 0xfe74,
   [0x5c6b] = 0xfe76, [0x5c6c] = 0xfe77, [0x5c6d] = 0xfe78, [0x5c6e] = 0xfe79,
   [0x5c6f] = 0xfe7a, [0x5c70] = 0xfe7b, [0x5c71] = 0xfe7c, [0x5c72] = 0xfe7d,
@@ -10363,7 +10366,7 @@
   [0x5ce3] = 0xfeee, [0x5ce4] = 0xfeef, [0x5ce5] = 0xfef0, [0x5ce6] = 0xfef1,
   [0x5ce7] = 0xfef2, [0x5ce8] = 0xfef3, [0x5ce9] = 0xfef4, [0x5cea] = 0xfef5,
   [0x5ceb] = 0xfef6, [0x5cec] = 0xfef7, [0x5ced] = 0xfef8, [0x5cee] = 0xfef9,
-  [0x5cef] = 0xfefa, [0x5cf0] = 0xfefb, [0x5cf1] = 0xfefc, [0x5cf4] = 0xfeff,
+  [0x5cef] = 0xfefa, [0x5cf0] = 0xfefb, [0x5cf1] = 0xfefc, [0x5cf4] = 0xfeff, [0x5cf5] = 0xff00,
   [0x5cf6] = 0xff5f, [0x5cf7] = 0xff60, [0x5cf8] = 0xff61, [0x5cf9] = 0xff62,
   [0x5cfa] = 0xff63, [0x5cfb] = 0xff64, [0x5cfc] = 0xff65, [0x5cfd] = 0xff66,
   [0x5cfe] = 0xff67, [0x5cff] = 0xff68, [0x5d00] = 0xff69, [0x5d01] = 0xff6a,
@@ -10393,7 +10396,7 @@
   [0x5d63] = 0xffcc, [0x5d64] = 0xffcd, [0x5d65] = 0xffce, [0x5d66] = 0xffcf,
   [0x5d69] = 0xffd2, [0x5d6a] = 0xffd3, [0x5d6b] = 0xffd4, [0x5d6c] = 0xffd5,
   [0x5d6d] = 0xffd6, [0x5d6e] = 0xffd7, [0x5d71] = 0xffda, [0x5d72] = 0xffdb,
-  [0x5d73] = 0xffdc, [0x5d77] = 0xffe6, [0x5d79] = 0xffe8, [0x5d7a] = 0xffe9,
+  [0x5d73] = 0xffdc, [0x5d76] = 0xffdf, [0x5d77] = 0xffe6, [0x5d79] = 0xffe8, [0x5d7a] = 0xffe9,
   [0x5d7b] = 0xffea, [0x5d7c] = 0xffeb, [0x5d7d] = 0xffec, [0x5d7e] = 0xffed,
   [0x5d7f] = 0xffee, [0x5d8a] = 0xfff9, [0x5d8b] = 0xfffa, [0x5d8c] = 0xfffb,
   [0x5d8d] = 0xfffc, [0x5d8e] = 0xfffd,
@@ -10458,7 +10461,7 @@
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 */
 
-static const unsigned char __ucs_to_gb18030_tab1[55168-11172][2] =
+static unsigned char __ucs_to_gb18030_tab1[55168-11172][2] =
 {
   [0x0000] = "\x20\x00", [0x0001] = "\x20\x01", [0x0002] = "\x20\x02",
   [0x0003] = "\x20\x03", [0x0004] = "\x20\x04", [0x0005] = "\x20\x05",
@@ -10699,7 +10702,7 @@
   [0x0316] = "\xa6\xa6", [0x0317] = "\xa6\xa7", [0x0318] = "\xa6\xa8",
   [0x0319] = "\xa6\xa9", [0x031a] = "\xa6\xaa", [0x031b] = "\xa6\xab",
   [0x031c] = "\xa6\xac", [0x031d] = "\xa6\xad", [0x031e] = "\xa6\xae",
-  [0x031f] = "\xa6\xaf", [0x0320] = "\xa6\xb0", [0x0321] = "\xa6\xb1",
+  [0x031f] = "\xa6\xaf", [0x0320] = "\xa6\xb0", [0x0321] = "\xa6\xb1", [0x0322] = "\x22\xe5",
   [0x0323] = "\xa6\xb2", [0x0324] = "\xa6\xb3", [0x0325] = "\xa6\xb4",
   [0x0326] = "\xa6\xb5", [0x0327] = "\xa6\xb6", [0x0328] = "\xa6\xb7",
   [0x0329] = "\xa6\xb8", [0x032a] = "\x22\xe6", [0x032b] = "\x22\xe7",
@@ -12256,7 +12259,7 @@
   [0x20fa] = "\x40\x30", [0x20fb] = "\x40\x31", [0x20fc] = "\x40\x32",
   [0x20fd] = "\x40\x33", [0x20fe] = "\x40\x34", [0x20ff] = "\x40\x35",
   [0x2100] = "\x40\x36", [0x2101] = "\x40\x37", [0x2102] = "\x40\x38",
-  [0x2103] = "\x40\x39", [0x2110] = "\xa1\xfb", [0x2111] = "\xa1\xfc",
+  [0x2103] = "\x40\x39", [0x210f] = "\x40\x45", [0x2110] = "\xa1\xfb", [0x2111] = "\xa1\xfc",
   [0x2112] = "\xa1\xfa", [0x2113] = "\xa1\xfd", [0x2114] = "\x40\x46",
   [0x2115] = "\x40\x47", [0x2116] = "\xa8\x49", [0x2117] = "\xa8\x4a",
   [0x2118] = "\xa8\x4b", [0x2119] = "\xa8\x4c", [0x211a] = "\x40\x48",
@@ -12464,7 +12467,7 @@
   [0x23c0] = "\x42\xc8", [0x23c1] = "\x42\xc9", [0x23c2] = "\x42\xca",
   [0x23c3] = "\x42\xcb", [0x23c4] = "\x42\xcc", [0x23c5] = "\x42\xcd",
   [0x23c6] = "\x42\xce", [0x23c7] = "\x42\xcf", [0x23c8] = "\x42\xd0",
-  [0x23c9] = "\x42\xd1", [0x23ca] = "\x42\xd2", [0x23e0] = "\xa2\xd9",
+  [0x23c9] = "\x42\xd1", [0x23ca] = "\x42\xd2", [0x23df] = "\x42\xe7", [0x23e0] = "\xa2\xd9",
   [0x23e1] = "\xa2\xda", [0x23e2] = "\xa2\xdb", [0x23e3] = "\xa2\xdc",
   [0x23e4] = "\xa2\xdd", [0x23e5] = "\xa2\xde", [0x23e6] = "\xa2\xdf",
   [0x23e7] = "\xa2\xe0", [0x23e8] = "\xa2\xe1", [0x23e9] = "\xa2\xe2",
@@ -12517,7 +12520,7 @@
   [0x2474] = "\x43\x4a", [0x2475] = "\x43\x4b", [0x2476] = "\x43\x4c",
   [0x2477] = "\x43\x4d", [0x2478] = "\x43\x4e", [0x2479] = "\x43\x4f",
   [0x247a] = "\x43\x50", [0x247b] = "\x43\x51", [0x247c] = "\x43\x52",
-  [0x247d] = "\x43\x53", [0x247e] = "\x43\x54", [0x2480] = "\xa9\xa4",
+  [0x247d] = "\x43\x53", [0x247e] = "\x43\x54", [0x247f] = "\x43\x55", [0x2480] = "\xa9\xa4",
   [0x2481] = "\xa9\xa5", [0x2482] = "\xa9\xa6", [0x2483] = "\xa9\xa7",
   [0x2484] = "\xa9\xa8", [0x2485] = "\xa9\xa9", [0x2486] = "\xa9\xaa",
   [0x2487] = "\xa9\xab", [0x2488] = "\xa9\xac", [0x2489] = "\xa9\xad",
@@ -13085,11 +13088,11 @@
   [0x2f4b] = "\x4d\x7d", [0x2f4c] = "\x4d\x7e", [0x2f4d] = "\x4d\x7f",
   [0x2f4e] = "\x4d\x80", [0x2f4f] = "\x4d\x81", [0x2f50] = "\x4d\x82",
   [0x2f51] = "\x4d\x83", [0x2f52] = "\x4d\x84", [0x2f53] = "\x4d\x85",
-  [0x2f54] = "\x4d\x86", [0x2f55] = "\x4d\x87", [0x2f70] = "\xa9\x8a",
+  [0x2f54] = "\x4d\x86", [0x2f55] = "\x4d\x87", [0x2f6f] = "\x4d\xa1", [0x2f70] = "\xa9\x8a",
   [0x2f71] = "\xa9\x8b", [0x2f72] = "\xa9\x8c", [0x2f73] = "\xa9\x8d",
   [0x2f74] = "\xa9\x8e", [0x2f75] = "\xa9\x8f", [0x2f76] = "\xa9\x90",
   [0x2f77] = "\xa9\x91", [0x2f78] = "\xa9\x92", [0x2f79] = "\xa9\x93",
-  [0x2f7a] = "\xa9\x94", [0x2f7b] = "\xa9\x95", [0x2f80] = "\xa1\xa1",
+  [0x2f7a] = "\xa9\x94", [0x2f7b] = "\xa9\x95", [0x2f7c] = "\x4d\xa2", [0x2f7f] = "\x4d\xa5", [0x2f80] = "\xa1\xa1",
   [0x2f81] = "\xa1\xa2", [0x2f82] = "\xa1\xa3", [0x2f83] = "\xa1\xa8",
   [0x2f84] = "\x4d\xa6", [0x2f85] = "\xa1\xa9", [0x2f86] = "\xa9\x65",
   [0x2f87] = "\xa9\x96", [0x2f88] = "\xa1\xb4", [0x2f89] = "\xa1\xb5",
@@ -13110,7 +13113,7 @@
   [0x2fb4] = "\x4d\xb8", [0x2fb5] = "\x4d\xb9", [0x2fb6] = "\x4d\xba",
   [0x2fb7] = "\x4d\xbb", [0x2fb8] = "\x4d\xbc", [0x2fb9] = "\x4d\xbd",
   [0x2fba] = "\x4d\xbe", [0x2fbb] = "\x4d\xbf", [0x2fbc] = "\x4d\xc0",
-  [0x2fbd] = "\x4d\xc1", [0x2fbe] = "\xa9\x89", [0x2fbf] = "\x4d\xc2",
+  [0x2fbd] = "\x4d\xc1", [0x2fbe] = "\xa9\x89", [0x2fbf] = "\x4d\xc2", [0x2fc0] = "\x4d\xc3",
   [0x2fc1] = "\xa4\xa1", [0x2fc2] = "\xa4\xa2", [0x2fc3] = "\xa4\xa3",
   [0x2fc4] = "\xa4\xa4", [0x2fc5] = "\xa4\xa5", [0x2fc6] = "\xa4\xa6",
   [0x2fc7] = "\xa4\xa7", [0x2fc8] = "\xa4\xa8", [0x2fc9] = "\xa4\xa9",
@@ -13173,7 +13176,7 @@
   [0x3074] = "\xa5\xf4", [0x3075] = "\xa5\xf5", [0x3076] = "\xa5\xf6",
   [0x3077] = "\x4d\xcd", [0x3078] = "\x4d\xce", [0x3079] = "\x4d\xcf",
   [0x307a] = "\x4d\xd0", [0x307b] = "\x4d\xd1", [0x307c] = "\xa9\x60",
-  [0x307d] = "\xa9\x63", [0x307e] = "\xa9\x64", [0x307f] = "\x4d\xd2",
+  [0x307d] = "\xa9\x63", [0x307e] = "\xa9\x64", [0x307f] = "\x4d\xd2", [0x3084] = "\x4d\xd7",
   [0x3085] = "\xa8\xc5", [0x3086] = "\xa8\xc6", [0x3087] = "\xa8\xc7",
   [0x3088] = "\xa8\xc8", [0x3089] = "\xa8\xc9", [0x308a] = "\xa8\xca",
   [0x308b] = "\xa8\xcb", [0x308c] = "\xa8\xcc", [0x308d] = "\xa8\xcd",
@@ -13246,7 +13249,7 @@
   [0x3191] = "\x4e\xbf", [0x3192] = "\x4e\xc0", [0x3193] = "\x4e\xc1",
   [0x3194] = "\x4e\xc2", [0x3195] = "\x4e\xc3", [0x3196] = "\x4e\xc4",
   [0x3197] = "\x4e\xc5", [0x3198] = "\x4e\xc6", [0x3199] = "\x4e\xc7",
-  [0x319a] = "\x4e\xc8", [0x319b] = "\x4e\xc9", [0x319c] = "\x4e\xca",
+  [0x319a] = "\x4e\xc8", [0x319b] = "\x4e\xc9", [0x319c] = "\x4e\xca", [0x319f] = "\x4e\xcd",
   [0x31a0] = "\xa2\xe5", [0x31a1] = "\xa2\xe6", [0x31a2] = "\xa2\xe7",
   [0x31a3] = "\xa2\xe8", [0x31a4] = "\xa2\xe9", [0x31a5] = "\xa2\xea",
   [0x31a6] = "\xa2\xeb", [0x31a7] = "\xa2\xec", [0x31a8] = "\xa2\xed",
@@ -15591,7 +15594,7 @@
   [0x4d2b] = "\x6a\x0f", [0x4d2c] = "\x6a\x10", [0x4d2d] = "\x6a\x11",
   [0x4d2e] = "\xfe\x9f", [0x4d2f] = "\x6a\x12", [0x4d30] = "\x6a\x13",
   [0x4d31] = "\x6a\x14", [0x4d32] = "\x6a\x15", [0x4d33] = "\x6a\x16",
-  [0x4d34] = "\x6a\x17", [0x4d35] = "\x6a\x18", [0x4d80] = "\xd2\xbb",
+  [0x4d34] = "\x6a\x17", [0x4d35] = "\x6a\x18", [0x4d7f] = "\x6a\x62", [0x4d80] = "\xd2\xbb",
   [0x4d81] = "\xb6\xa1", [0x4d82] = "\x81\x40", [0x4d83] = "\xc6\xdf",
   [0x4d84] = "\x81\x41", [0x4d85] = "\x81\x42", [0x4d86] = "\x81\x43",
   [0x4d87] = "\xcd\xf2", [0x4d88] = "\xd5\xc9", [0x4d89] = "\xc8\xfd",
@@ -22558,7 +22561,7 @@
   [0x9f1a] = "\xb9\xa8", [0x9f1b] = "\xed\xe8", [0x9f1c] = "\xfd\x94",
   [0x9f1d] = "\xfd\x95", [0x9f1e] = "\xfd\x96", [0x9f1f] = "\xb9\xea",
   [0x9f20] = "\xd9\xdf", [0x9f21] = "\xfd\x97", [0x9f22] = "\xfd\x98",
-  [0x9f23] = "\xfd\x99", [0x9f24] = "\xfd\x9a", [0x9f25] = "\xfd\x9b",
+  [0x9f23] = "\xfd\x99", [0x9f24] = "\xfd\x9a", [0x9f25] = "\xfd\x9b", [0x9f26] = "\x6a\x63",
   [0x9f80] = "\x6a\xbd", [0x9f81] = "\x6a\xbe", [0x9f82] = "\x6a\xbf",
   [0x9f83] = "\x6a\xc0", [0x9f84] = "\x6a\xc1", [0x9f85] = "\x6a\xc2",
   [0x9f86] = "\x6a\xc3", [0x9f87] = "\x6a\xc4", [0x9f88] = "\x6a\xc5",
@@ -22965,7 +22968,8 @@
   [0xa43c] = "\x6f\x79", [0xa43d] = "\x6f\x7a", [0xa43e] = "\x6f\x7b",
   [0xa43f] = "\x6f\x7c", [0xa440] = "\x6f\x7d", [0xa441] = "\x6f\x7e",
   [0xa442] = "\x6f\x7f", [0xa443] = "\x6f\x80", [0xa444] = "\x6f\x81",
-  [0xa445] = "\x6f\x82", [0xa446] = "\x6f\x83",
+  [0xa445] = "\x6f\x82", [0xa446] = "\x6f\x83", [0xab7f] = "\x76\xbc",
+  [0xab80] = "\xa2\x61", [0xabdb] = "\xa2\xbc",
 };
 
 /* Table for UCS-4 -> GB18030, for the range U+E000..U+FFFF.
@@ -23021,7 +23025,7 @@
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 */
 
-static const unsigned char __ucs_to_gb18030_tab2[8192][2] =
+static unsigned char __ucs_to_gb18030_tab2[8192][2] =
 {
   [0x076c] = "\x20\x00", [0x07c8] = "\x20\x01", [0x07e7] = "\x20\x02",
   [0x07e8] = "\x20\x03", [0x07e9] = "\x20\x04", [0x07ea] = "\x20\x05",
@@ -24804,8 +24808,9 @@
   [0x1e0a] = "\x35\xe1", [0x1e0b] = "\x35\xe2", [0x1e0c] = "\x35\xe3",
   [0x1e0d] = "\x35\xe4", [0x1e0e] = "\x35\xe5", [0x1e0f] = "\x35\xe6",
   [0x1e20] = "\x35\xf7", [0x1e21] = "\x35\xf8", [0x1e22] = "\x35\xf9",
-  [0x1e23] = "\x35\xfa", [0x1e32] = "\x36\x07", [0x1e45] = "\x36\x08",
-  [0x1e46] = "\x36\x09", [0x1e58] = "\x36\x0d", [0x1e70] = "\x36\x13",
+  [0x1e23] = "\x35\xfa", [0x1e2f] = "\x36\x06", [0x1e32] = "\x36\x07", [0x1e45] = "\x36\x08",
+  [0x1e46] = "\x36\x09", [0x1e48] = "\x36\x0b", [0x1e53] = "\x36\x0c",
+  [0x1e58] = "\x36\x0d", [0x1e67] = "\x36\x0e", [0x1e6c] = "\x36\x0f", [0x1e70] = "\x36\x13",
   [0x1e71] = "\x36\x14", [0x1e72] = "\x36\x15", [0x1e73] = "\x36\x16",
   [0x1e74] = "\x36\x17", [0x1e76] = "\x36\x19", [0x1e77] = "\x36\x1a",
   [0x1e78] = "\x36\x1b", [0x1e79] = "\x36\x1c", [0x1e7a] = "\x36\x1d",
@@ -24852,7 +24857,7 @@
   [0x1ef3] = "\x36\x96", [0x1ef4] = "\x36\x97", [0x1ef5] = "\x36\x98",
   [0x1ef6] = "\x36\x99", [0x1ef7] = "\x36\x9a", [0x1ef8] = "\x36\x9b",
   [0x1ef9] = "\x36\x9c", [0x1efa] = "\x36\x9d", [0x1efb] = "\x36\x9e",
-  [0x1efc] = "\x36\x9f", [0x1eff] = "\x36\xa2", [0x1f5f] = "\x36\xa4",
+  [0x1efc] = "\x36\x9f", [0x1eff] = "\x36\xa2", [0x1f00] = "\x36\xa3", [0x1f5f] = "\x36\xa4",
   [0x1f60] = "\x36\xa5", [0x1f61] = "\x36\xa6", [0x1f62] = "\x36\xa7",
   [0x1f63] = "\x36\xa8", [0x1f64] = "\x36\xa9", [0x1f65] = "\x36\xaa",
   [0x1f66] = "\x36\xab", [0x1f67] = "\x36\xac", [0x1f68] = "\x36\xad",
@@ -24891,7 +24896,7 @@
   [0x1fce] = "\x37\x13", [0x1fcf] = "\x37\x14", [0x1fd2] = "\x37\x17",
   [0x1fd3] = "\x37\x18", [0x1fd4] = "\x37\x19", [0x1fd5] = "\x37\x1a",
   [0x1fd6] = "\x37\x1b", [0x1fd7] = "\x37\x1c", [0x1fda] = "\x37\x1f",
-  [0x1fdb] = "\x37\x20", [0x1fdc] = "\x37\x21", [0x1fe6] = "\x37\x25",
+  [0x1fdb] = "\x37\x20", [0x1fdc] = "\x37\x21", [0x1fdf] = "\x37\x24", [0x1fe6] = "\x37\x25",
   [0x1fe8] = "\x37\x27", [0x1fe9] = "\x37\x28", [0x1fea] = "\x37\x29",
   [0x1feb] = "\x37\x2a", [0x1fec] = "\x37\x2b", [0x1fed] = "\x37\x2c",
   [0x1fee] = "\x37\x2d", [0x1ff9] = "\x37\x38", [0x1ffa] = "\x37\x39",
@@ -25734,8 +25739,10 @@
 		ch = __fourbyte_to_ucs[idx-11172];		              \
 	      else if (idx >= 0x830e && idx <= 0x93d4)		              \
 		ch = idx + 0x6557; 					      \
-	      else if (idx > 0x93d4 && idx < 0x99fb)		              \
+	      else if (idx > 0x93d4 && idx <= 0x99fb)		              \
 		ch = __fourbyte_to_ucs[idx-11172-4295];			      \
+	      else if (idx >= 0x2e248)              		              \
+		ch = idx - 0x1e248;                    			      \
 	      else							      \
 		ch = 0;							      \
 									      \
@@ -25817,7 +25824,7 @@
 	else if (ch >= 0xD7A4 && ch <= 0xD7FF)				      \
 	  {								      \
 	    cp = __ucs_to_gb18030_tab1[ch - 0x80 - 11172];		      \
-	    if (*cp && *cp < 0x81) {					      \
+	    if (*cp && *cp < 0xa3) {					      \
 		idx = (cp[0] - 0x20) * 256 + cp[1];		              \
 		len = 4;						      \
 	    }								      \
@@ -25833,7 +25840,10 @@
             if ((cp[0] == 0)&&(cp[1] == 0)) len = 0;                          \
 	  }								      \
 	else  								      \
-	  len = 0;							      \
+	  {								      \
+	    idx = ch + 0x1e248;						      \
+	    len = 4;							      \
+	  }								      \
 									      \
 	if (__builtin_expect (len, 2) == 0				      \
 	    || (len == 2 && __builtin_expect (cp[0], '\1') == '\0'))          \
@@ -25886,3 +25896,86 @@
 
 /* Now define the toplevel functions.  */
 #include <iconv/skeleton.c>
+
+#define DEBUG
+#ifdef DEBUG
+#include <stdio.h>
+#include <assert.h>
+#endif
+/* Initialization: fill the holes in __fourbyte_to_ucs table */
+__attribute__((constructor))
+static void initialize_gb18030()
+{
+    int i;
+    int lastz = 0;
+    for (i = 0; i < sizeof(__fourbyte_to_ucs) / sizeof(__fourbyte_to_ucs[0]); i++)
+    {
+        if (__fourbyte_to_ucs[i] == 0 && i > 0)
+        {
+            __fourbyte_to_ucs[i] = __fourbyte_to_ucs[i-1] + 1;
+            lastz = 1;
+        }
+        else
+        {
+#ifdef DEBUG
+            if (lastz)
+            {
+                if (__fourbyte_to_ucs[i] != __fourbyte_to_ucs[i-1] + 1)
+                    fprintf(stderr, "i=0x%04x, __fourbyte_to_ucs[i]=0x%04x\n", i, __fourbyte_to_ucs[i]);
+                assert(__fourbyte_to_ucs[i] == __fourbyte_to_ucs[i-1] + 1);
+            }
+#endif
+            lastz = 0;
+        }
+    }
+    lastz = 0;
+    for (i = 0; i < sizeof(__ucs_to_gb18030_tab1) / sizeof(__ucs_to_gb18030_tab1[0]); i++)
+    {
+        if (__ucs_to_gb18030_tab1[i][0] == 0 && i > 0)
+        {
+            assert(__ucs_to_gb18030_tab1[i][1] == 0);
+            __ucs_to_gb18030_tab1[i][0] = __ucs_to_gb18030_tab1[i-1][0];
+            __ucs_to_gb18030_tab1[i][1] = __ucs_to_gb18030_tab1[i-1][1] + 1;
+            if (__ucs_to_gb18030_tab1[i][1] == 0)
+                __ucs_to_gb18030_tab1[i][0]++;
+            lastz = 1;
+        }
+        else
+        {
+#ifdef DEBUG
+            if (lastz)
+            {
+                if (((int)__ucs_to_gb18030_tab1[i][0] * 256 + __ucs_to_gb18030_tab1[i][1])  != ((int)__ucs_to_gb18030_tab1[i-1][0] * 256 + __ucs_to_gb18030_tab1[i-1][1]) + 1)
+                    fprintf(stderr, "i=0x%04x, __ucs_to_gb18030_tab1[i]=\\x%02x\\x%02x, __ucs_to_gb18030_tab1[i-1]=\\x%02x\\x%02x\n", i, __ucs_to_gb18030_tab1[i][0], __ucs_to_gb18030_tab1[i][1], __ucs_to_gb18030_tab1[i-1][0], __ucs_to_gb18030_tab1[i-1][1]);
+                assert(((int)__ucs_to_gb18030_tab1[i][0] * 256 + __ucs_to_gb18030_tab1[i][1])  == ((int)__ucs_to_gb18030_tab1[i-1][0] * 256 + __ucs_to_gb18030_tab1[i-1][1]) + 1);
+            }
+#endif
+            lastz = 0;
+        }
+    }
+    lastz = 0;
+    for (i = 0; i < sizeof(__ucs_to_gb18030_tab2) / sizeof(__ucs_to_gb18030_tab2[0]); i++)
+    {
+        if (__ucs_to_gb18030_tab2[i][0] == 0 && i > 0)
+        {
+            assert(__ucs_to_gb18030_tab2[i][1] == 0);
+            __ucs_to_gb18030_tab2[i][0] = __ucs_to_gb18030_tab2[i-1][0];
+            __ucs_to_gb18030_tab2[i][1] = __ucs_to_gb18030_tab2[i-1][1] + 1;
+            if (__ucs_to_gb18030_tab2[i][1] == 0)
+                __ucs_to_gb18030_tab2[i][0]++;
+            lastz = 1;
+        }
+        else
+        {
+#ifdef DEBUG
+            if (lastz)
+            {
+                if (((int)__ucs_to_gb18030_tab2[i][0] * 256 + __ucs_to_gb18030_tab2[i][1])  != ((int)__ucs_to_gb18030_tab2[i-1][0] * 256 + __ucs_to_gb18030_tab2[i-1][1]) + 1)
+                    fprintf(stderr, "i=0x%04x, __ucs_to_gb18030_tab2[i]=\\x%02x\\x%02x, __ucs_to_gb18030_tab2[i-1]=\\x%02x\\x%02x\n", i, __ucs_to_gb18030_tab2[i][0], __ucs_to_gb18030_tab2[i][1], __ucs_to_gb18030_tab2[i-1][0], __ucs_to_gb18030_tab2[i-1][1]);
+                assert(((int)__ucs_to_gb18030_tab2[i][0] * 256 + __ucs_to_gb18030_tab2[i][1])  == ((int)__ucs_to_gb18030_tab2[i-1][0] * 256 + __ucs_to_gb18030_tab2[i-1][1]) + 1);
+            }
+#endif
+            lastz = 0;
+        }
+    }
+}
