\documentclass[12pt]{article}
\usepackage{CJK, CJKnumb, CJKpunct, indentfirst}
\begin{CJK*}{GBK}{song}
\end{CJK*}
\usepackage[margin=3.14cm]{geometry}
\usepackage[]{hyperref}
\usepackage{multicol}
\setlength{\columnseprule}{0.4pt}
\usepackage{titlesec}
\titleformat{\section}{\large\CJKfamily{kai}\bfseries}{\arabic{section}}{1em}{}[]
\titlespacing{\section}{0em}{*2.5}{*1.5}
\titleformat{\subsection}{\CJKfamily{hei}\bfseries}{\arabic{section}.\arabic{subsection}}{1ex}{}[]
\titlespacing{\subsection}{0.5ex}{*1}{*0.5}
\titleformat{\subsubsection}{}{\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}{1ex}{}[]
\titlespacing{\subsubsection}{0.6ex}{*0.5}{*0}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[L]{\CJKfamily{fs}\small 面向对象技术实验报告}
\fancyhead[R]{\CJKfamily{kai}\small 姓名：尹甸\quad 学号：PB04000837}
\fancyfoot{}
\fancyfoot[C]{--\thepage--}
\renewcommand{\CJKbold}{}
\usepackage{paralist}
\usepackage{listings}
\renewcommand{\baselinestretch}{1.3}
\renewcommand{\contentsname}{\centerline{\CJKfamily{hei}目录}}
\renewcommand{\lstlistlistingname}{\centerline{\CJKfamily{hei}代码列表}}
\renewcommand{\lstlistingname}{代码}
\newcommand{\inputcppcode}[1]{
	\renewcommand{\baselinestretch}{1}
	\lstinputlisting[language=C++,basicstyle=\scriptsize,breaklines,breakautoindent,fontadjust,
	escapeinside={/*@}{@*/},flexiblecolumns,
	caption=#1]{#1}
	\renewcommand{\baselinestretch}{1.3}
}
\newcommand{\inputalgcode}[1]{
	\renewcommand{\baselinestretch}{1}
	\lstinputlisting[language=C++,basicstyle=\footnotesize,flexiblecolumns,tabsize=4,aboveskip=0em,belowskip=0em,
		xleftmargin=\parindent,breaklines,breakautoindent,fontadjust]{#1}
	\renewcommand{\baselinestretch}{1.3}
}

\begin{document}
\begin{CJK*}{GBK}{song}
	\CJKindent

	\vspace*{5cm}
	\thispagestyle{empty}
	\begin{center}
		{\small \CJKfamily{fs} 面向对象技术实验报告}
		\\[1em]
		{\Huge \CJKfamily{kai} 通\ \ 讯\ \ 录}
		\\[3em]
		{姓名：\underline{\CJKfamily{kai}\ \ 尹甸\ \ } \qquad 学号：\underline{\ PB04000837\ }\qquad 得分：
		\underline{\hspace*{5em}}}
	\end{center}
	\newpage
	\begin{titlepage}
		\vspace*{2em}
		\begin{center}
			{\small\CJKfamily{fs}面向对象技术实验报告\\[1em]\Huge\CJKfamily{kai}通\ \ 讯\ \ 录}
			\\[1em]
			{\CJKfamily{kai}尹甸\\PB04000837\\\small E-mail: \texttt{yindian@mail.ustc.edu.cn}}

			\vspace*{2em}
			\begin{minipage}{0.8\textwidth}
				\small
				\tableofcontents
				%\lstlistoflistings
			\end{minipage}
		\end{center}
	\end{titlepage}
	\setcounter{page}{1}
	%%%%%%%%%%%%		Now the main text begins 		%%%%%%
	\vspace*{0.5ex}
	\begin{center}
		{\Large\CJKfamily{hei} 大作业：\quad 通\ 讯\ 录}
		\\[1em]
		{姓名：\underline{\CJKfamily{kai}\ \ 尹甸\ \ } \qquad 学号：\underline{\ PB04000837\ }\qquad 得分：
		\underline{\hspace*{5em}}}
	\end{center}
	\vspace*{0.5ex}
	\section{实验题目}
	设计一个实用的小型通信录程序，具有查询和删除功能，并且能够打开指定文件或修改指定文件及将多个文件组成一个文件。
	\section{实验要求}
	\subsection{建立文件}
	\begin{compactenum}[\indent(1)]
		\item 存储文件可以使用默认文件名或指定文件名。
		\item 可以不保存输入记录，但需要确认是否保存输入记录。
		\item 如果已经有文件，只能在其后追加。
		\item 新增的记录可以不存入原文件中，也可以用原来的文件覆盖内存的内容。
		\item 可以将指定文件的内容追加到目前内存中的链表后面。 
	\end{compactenum}
	\subsection{文件的存取和显示}
	\begin{compactenum}[\indent(1)]
		\item 可以单独存取文件。
		\item 可以随时显示内存中记录的全部内容。
		\item 可以直接存取默认文件或指定文件。 
	\end{compactenum}
	\subsection{删除记录 }
	\begin{compactenum}[\indent(1)]
		\item 可以按“姓名”或“电话”方式删除记录并更新内存链表内容。
		\item 能给出被删除记录的信息。
		\item 如果已经是空表，删除时应给出提示信息并返回主菜单。
		\item 如果没有要删除的信息，输出没有找到的信息。
		\item 删除操作仅限于内存，只有执行存记录时，才能覆盖原记录。 
	\end{compactenum}
	\subsection{查询记录 }
	\begin{compactenum}[\indent(1)]
		\item 可以按“姓名”或“电话”方式查询记录。
		\item 能给出查询记录的信息。
		\item 如果查询的信息不存在，输出没有找到的信息。 
	\end{compactenum}
	\subsection{整体性能 }
	\begin{compactenum}[\indent(1)]
		\item 可以单独存取文件。
		\item 应可以随时检索、删除或增加新记录，保存或取消新的记录。
		\item 姓名可由字符和数字混合编码。 
		\item 电话号码可由字符和数字组成。
		\item 将输出信息加上输出信息栏。
		\item 使用菜单实现功能的正确选择。 
	\end{compactenum}
	\subsection{测试程序 }
	\begin{compactenum}[\indent(1)]
		\item 应列出测试大纲对程序进行测试。
		\item 应保证测试用例测试到程序的各种边缘情况。 
	\end{compactenum}
	\section{设计思想}
	\subsection{总体设计思想}
	本程序采用自顶向下的设计方法。下面对我设计的思路做一个简要的说明。
	\begin{itemize}[\indent\textbullet]
		\item 本程序采用命令行进行交互，因此，程序运行部分的代码结构应为：（1）、读命令；（2）、根据读入的命令运行
			相应的操作；（3）、如果输入的命令不是“终止程序”，则转（1），否则执行收尾操作。
		\item 根据题目的要求，存放记录的数据结构主要进行插入记录、删除记录及查找记录这些操作，同时也要能够读取及存
			放记录。因此采用链表来存放记录比较方便。为了提高效率，可采用标准模版库（STL）中的~list 类来实现。而
			通讯录的记录则可使用结构体来存储。
		\item 按照数据结构的层次，可以设计三个类：RecordList 类是用来存放记录的链表，通过继承\ list$<$Record$>$ 来实
			现链表的基本操作；AddressList 类是实现通讯录基本操作（插入、删除、查找、读取、存放记录）的类，它以
			包含关系持有一个\ RecordList 类的对象\ recList，做为存取记录的数据结构；AddressBook 类是实现操作界
			面并与用户交互的类，它继承自\ AddressList，以私有方式实现了所有交互的功能，并通过公有的
			~run() 函数向外界提供了运行通讯录程序的接口。
	\end{itemize}
	\subsection{细节上的考虑}
	\begin{enumerate}
		\item {Record 结构体}\\
			为了便于输入及输入不定长的字符串，采用\ string 类存储记录。为了方便比较记录的同异，可以重载\ == 运算符。
		\item {RecordList 类}\\
			由于\ list 模版类已经实现了所有的链表的基本操作，因此\ RecordList 类可以直接继承自\ list$<$Record$>$，不需要任何改
			变。也可以用\ \textbf{typedef} 定义之。
		\item {AddressList 类}\\
			添加记录时应该防止记录重复。查找记录时，可以返回包含待查字符串的记录，而不一定是姓名或电话与待查字
			符串完全相同的记录，这样使用会更方便。存取记录时，记录中姓名、电话各占一行，这样能够有效解决姓名或
			电话中包含空格的情形。
		\item {AddressBook 类}
			\begin{compactenum}[(1)]
				\item 可以将所有需要显示的字符串集中放置，用\ \textbf{char}* 的形式存放。这样不仅方便改动字
					符串，也可以为程序提供多语种化的余地，编写者能够比较容易地添加多语种支持：只需从文
					件中读取字符串，并将这些字符指针指向相应新的地址即可。
				\item 为了获得当前通讯录是否已修改的信息，增加布尔变量\ isModified，并在每次增加、删除、读
					取之后将其置真，在存放后将其置假。
				\item 采用\ readCommand() 函数显示菜单项并获取用户输入的选项。在程序的主要运行部分\
					AddressBook::run() 中，不断地根据\ readCommand() 函数的返回值调用\ act() 函数进行行
					为动作，并在检测到退出信号时根据\ isModified 的状态执行存盘任务。
				\item 在与用户交互的过程中，时常会出现用户输入错误的情况，例如将本来应该输入整数的地方输了
					字母，这样输入就会出错。故可以编写一个\ clearline() 函数，负责清除错误的输入，以便
					接受新的输入。
			\end{compactenum}
	\end{enumerate}
	\section{算法分析}
	本程序涉及到算法的部分并不多，并没有用到什么高深的方法，程序编写的大致方法也已经在“设计思想”一节中阐述了。而编程
	中主要应该注意的问题则是如何提高输入的容错性。下面，我就选择性地选取一些内容讲讲。
	\subsection{各个类的公有接口}
	\inputalgcode{ publicinterface.alg}
	\subsection{findRecord 的实现}
	\inputalgcode{ findrecord.alg}
	\subsection{AddressBook::run() 的实现}
	\inputalgcode{ addressbookrun.alg}
	\subsection{AddressBook::readCommand() 的实现}
	\inputalgcode{ addressbookreadcommand.alg}
	\subsection{AddressBook::act() 的实现}
	\inputalgcode{ addressbookact.alg}
	\section{实验结果}
	\subsection{测试大纲}
	经过考虑，决定对程序的如下方面进行测试（按测试顺序排列）。
	\begin{compactenum}[\indent(1)]
		\item 空表及空文件测试。
		\item 添加记录及文件存储测试。
		\item 查询和删除记录测试。
		\item 错误输入测试。
	\end{compactenum}

	这样的测试覆盖了程序的全部功能，并且还考验了程序在遇到错误输入时的容错性，是完整、彻底的测试方案。
	\subsection{测试用例}
	\begin{enumerate}
		\item 空表及空文件测试。在没有产生文件之前，对需要用到文件和链表信息的菜单进行选择，看它们是否满足要求。这
			时，选择除了“增加记录”、“新建通讯录”、“读取记录”和“结束运行”之外的所有选项都会得到“没有记
			录”之类的错误提示。而由于没有相应的数据文件，“读取记录”应该出现打不开文件的错误提示。
		\item 添加记录及文件存储测试。通过选择“增加记录”并输入相应数据来测试向链表中添加数据的部分。通过选择“保
			存记录”或在通讯录有改动的情况下选“结束运行”，可以测试程序存储记录到文件的功能。通过选择“读取记
			录”可以测试从文件中读取记录并追回到链表尾部的功能。可以通过“显示记录”来查看验证。
		\item 查询和删除记录测试。通过选择“查询记录”和“删除记录”选项来测试程序相应的功能。通过“显示记录”来查
			看验证。
		\item 错误输入测试。在菜单选择项输入及查询与删除记录时的姓名、电话号码选项处输入错误的整数或者其他字符串，
			测试程序对错误输入整数的容错能力。在要求输入姓名或电话号码字符串时，测试对空字符串的容错能力。
	\end{enumerate}
	\subsection{测试结果}
	\begin{enumerate}
		\item 空表及空文件测试。
			\begin{multicols}{3}
				\small\renewcommand{\baselinestretch}{1}
				\begin{verbatim}
				**********************
				* 欢迎使用简易通讯录 *
				**********************
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 1
				没有记录！
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 2
				记录是空表，退出查询操作
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 4
				记录是空表，退出查询操作
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 5
				没有记录可存！
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 6
				请输入文件名（直接回车选择文件sname）：
				打不开文件！请重新选择
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 6
				请输入文件名（直接回车选择文件sname）：abcdefg
				打不开文件！请重新选择
				------------
				1. 显示记录
				2. 查询记录
				3. 增加记录
				4. 删除记录
				5. 保存记录
				6. 读取记录
				7. 新建通讯录
				8. 结束运行
				左边数字对应功能选择，请选1-8: 0
				输入错误，重选1-8：8
				退出操作，再见！
				\end{verbatim}
			\end{multicols}
		\item 添加记录及文件存储测试。
			\begin{multicols}{2}
				\small\renewcommand{\baselinestretch}{1}
				\begin{verbatim}
**********************
* 欢迎使用简易通讯录 *
**********************
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 3
输入数据，输入姓名为0时结束。
姓名: 张三
电话: (86) 10-8848888
姓名: 李四
电话: 13812345678
姓名: 0
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 1
姓名                电话
张三                (86) 10-8848888
李四                13812345678
一共有2条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 5
请输入文件名（直接回车选择文件sname）：
2条记录已经存入文件，请继续操作。
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 3
输入数据，输入姓名为0时结束。
姓名: 王五
电话: +86 551 3601234
姓名: 0
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 8
通讯录已改动，是否保存？(Y/n)y
请输入文件名（直接回车选择文件sname）：
3条记录已经存入文件，请继续操作。
退出操作，再见！

D:\work\oop\addressbook>addrbook.exe
**********************
* 欢迎使用简易通讯录 *
**********************
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 1
没有记录！
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 6
请输入文件名（直接回车选择文件sname）：
一共有3条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 1
姓名                电话
张三                (86) 10-8848888
李四                13812345678
王五                +86 551 3601234
一共有3条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 7
输入数据，输入姓名为0时结束。
姓名: D. E. Knuth
电话: 00 01 0101001
姓名: 0
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 1
姓名                电话
D. E. Knuth         00 01 0101001
一共有1条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 6
请输入文件名（直接回车选择文件sname）：
一共有4条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 1
姓名                电话
D. E. Knuth         00 01 0101001
张三                (86) 10-8848888
李四                13812345678
王五                +86 551 3601234
一共有4条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 8
通讯录已改动，是否保存？(Y/n)y
请输入文件名（直接回车选择文件sname）：
4条记录已经存入文件，请继续操作。
退出操作，再见！
				\end{verbatim}
			\end{multicols}
		\item 查询和删除记录测试。
			\begin{multicols}{2}
				\small\renewcommand{\baselinestretch}{1}
				\begin{verbatim}
**********************
* 欢迎使用简易通讯录 *
**********************
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 6
请输入文件名（直接回车选择文件sname）：
一共有6条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 2
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：1
请输入姓名: 李四
姓名                电话
李四                13812345678
李四                0551-3601357
一共找到了2条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 2
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：2
请输入电话: 3601234
姓名                电话
王五                +86 551 3601234
王二麻子            0551-3601234
一共找到了2条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 4
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：1
请输入姓名: 张三
姓名                电话
张三                (86) 10-8848888
确定要删除这条记录吗？[y/N]y
一共删除了1条记录
现在还有5条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 8
通讯录已改动，是否保存？(Y/n)n
退出操作，再见！
				\end{verbatim}
			\end{multicols}

		\item 错误输入测试。
			\begin{multicols}{2}
				\small\renewcommand{\baselinestretch}{1}
				\begin{verbatim}
**********************
* 欢迎使用简易通讯录 *
**********************
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 10
输入错误，重选1-8：
abc
输入错误，重选1-8：6
请输入文件名（直接回车选择文件sname）：dee
打不开文件！请重新选择
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 6
请输入文件名（直接回车选择文件sname）：
一共有6条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 2
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：abc
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：3
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：0
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：1
请输入姓名:
请重新输入 eee
对不起，没有找到你的记录。
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 4
可以通过姓名或电话号码查找或删除记录
1. 通过姓名
2. 通过电话
请输入你的选择：2
请输入电话:
请重新输入 7
姓名                电话
李四                13812345678
确定要删除这条记录吗？[y/N]y
李四                0551-3601357
确定要删除这条记录吗？[y/N]n
一共删除了1条记录
现在还有5条记录
------------
1. 显示记录
2. 查询记录
3. 增加记录
4. 删除记录
5. 保存记录
6. 读取记录
7. 新建通讯录
8. 结束运行
左边数字对应功能选择，请选1-8: 8
通讯录已改动，是否保存？(Y/n)e
请输入文件名（直接回车选择文件sname）：
5条记录已经存入文件，请继续操作。
退出操作，再见！
				\end{verbatim}
			\end{multicols}

	\end{enumerate}
	\section{结果分析}
	至此，我较完美地完成了本次实验。通过该实验，我编写出了一个简单、小巧的通讯录程序，具有插入、删除、查找、读取和存放
	记录的功能，并具有良好的容错性。本次实验采取了自顶向下的设计思想，模块化的设计方法，锻炼了我编写较大规模应用程序以
	及面向对象编程的能力。本程序还有可以改进的地方，比如增加多语种界面，增加其他功能，使用可视化界面等。由于在编程中考
	虑到了多语言情况，采用枚举存储用户输入命令并进行相应处理，采用交互界面与底层操作相分离的设计方法等，使得程序的改进
	不是难事。总之，本次实验还是相当成功的。
	\section{程序清单}
	\inputcppcode{ addrbook.cpp}
	\inputcppcode{ addrbook.h}

\clearpage
\end{CJK*}
\end{document}
