\documentclass[cs4size]{ctexart}
\usepackage[margin=2cm]{geometry}
\usepackage[CJKbookmarks,bookmarks,bookmarksnumbered,dvipdfm]{hyperref}
\special{pdf:tounicode GBK-EUC-UCS2}
\usepackage{epsfig}
\usepackage{titlesec}
\usepackage{shortvrb}
\MakeShortVerb{\|}
\titleformat{\section}{\Large\bfseries}{\sffamily No.\@ \arabic{section} --- }{0ex}{}
\titlespacing{\section}{0em}{10pt plus 2pt minus 5pt}{5pt plus 2pt minus 2pt}
\titleformat{\subsection}{\large\bfseries}{}{0em}{}
\titlespacing{\subsection}{0em}{6pt plus 3pt}{2pt plus 1pt}
\begin{CJK*}{GBK}{song}
\end{CJK*}
\newenvironment{bigquote}{\begin{quote}\bfseries\slshape\Large“}
	{”\end{quote}}
\newcommand{\pzh}{$\vcenter{\hrule width 2em height 0.4pt}$}
\begin{document}
\title{\bfseries 黑客侵入网络的五大途径及防范方法}
\author{\sffamily Peter Wood, First Base Technologies CEO\\
\normalsize 翻译：尹甸\qquad PB04000837}
\date{}
\maketitle
\begin{quote}
	\bfseries
	侵入公司网络从未如此容易。在过去的十年中，我参与了大量的渗透测试，既有
	从公司内部的入侵也有从公司外部的。这段时期出现了一些重要的主题，虽然它
	们明显不相关联，但却共同导致了公司缺乏足够能力来保护其信息资产。
\end{quote}

我的“五大网络弱点”是我数年来伦理黑客经验的浓缩，代表了我对于攻击者危害网络安
全最有可能采取的途径的看法。如你所料，这篇文章谈论的并不都是技术上的控制。这是
网络安全的一般情形，以现实世界为基础，并汇集了数百次测试的信息。

\section{乐于助人的职员}
通常，除了社会工程的从业者，IT~社区实际上并不知晓社会工程学。最近一波钓鱼诈骗
的风波，以及诸如~Kevin Mitnick~的《欺骗之道》等书籍的出版，已经引起了人们的警
觉。然而，大多数用户在日常工作中并没有猜疑的思想准备，对于通过愚弄人来偷取信息
的容易性浑然无知。

\begin{bigquote}
	我们询问~IT~项目主管的姓名和电子邮件地址……\\
	接待员愉快地在电话上告诉了我们这个信息。
\end{bigquote}

这是从我们伦理黑客的现实经历中选出的一个典型例子。首先我们在本地的大街上购入一
个“即付即用”的手机。随后我们呼叫目标公司的电话总机号码，当然它在网上免费可得
。我们询问负责我们感兴趣的部门（通常是处理工资表及支付款系统的）的~IT~项目主管
的姓名和电子邮件地址。除了询问我们是不是招募公司以外，接待员没有做其他检验，并
愉快地在电话上告诉了我们这个信息。
\subsection{然后欺骗网页来了}
接下来我们研究了此公司的网站，并创建了一个和该公司站点同样风格、甚至使用相同图
片和徽标（通过把真实的图片路径嵌入我们的代码中）的欺骗网页。这个欺骗网页表面上
是一个关于信息安全政策的问卷调查表，它基于~BS 7799（现~ISO 27001，信息安全管理
的标准），包含一些简单的问题，例如你如何选取你的密码，是否会它写在纸上，等等。

然后我们使用一个欺骗性的源电邮地址，分别向我们的目标项目经理发送电子邮件，并声
称自己是公司的信息安全部门经理，要求他们完成一个简短的问卷调查表，并将网页链接
给他们。大多数人会对这些极其显然的问题心存疑虑，但会相信他们看到的事实：网页看
上去符合制定模式，这封请求信似乎确实来自他们自己的信息安全部门经理。

甚至，他们点击链接后，会发现首先要求做的是输入其用户名和密码以确认身份。当然，
这就是诈骗之所在，因为剩下的问卷调查与我们无关（尽管可能很有趣），我们想要的只
是他们的资格认证。用这个方法，我们迅速地收获了一批有价值的网络证书，无论如何对
我们也没有风险，甚至还没有在现实中靠近目标公司。

\begin{bigquote}
	我们使用一个欺骗性的源电邮地址，分别向我们的目标项目经理发送电子邮件
	，并声称自己是公司的信息安全部门经理
\end{bigquote}

当这个诈骗随后被某个警觉心较强的人戳穿，并且所有的密码都被更改后，他们已经晚了
一步，因为我们已经使用这些资格认证远程登录到他们的企业外部网，并设置了我们自己
的“后门”账号。
\subsection{另外可行的行动方针}
另一个几乎没有暴露的危险、并且立马可以访问网络的技术如下所述。第一步和前面的欺
骗很类似。我们又一次使用我们的“即付即用”手机拨打目标公司的总机电话。这一次我
们询问上级~IT~职员的名称、工作职称和直拨电话号码。

收集到我们的列表后，我的一个同事拨打公司服务台的电话，声称是上级人员之一。他解
释说他正在用他的公司笔记本电脑在家里工作，但是远程登录总是失败，应该是忘记了密
码。他告诉服务台接线员，他得出去从幼儿园接他的小孩，所以请他们重置他的账号并告
知他新的密码。当然，他给了他们他的新的、不可跟踪的手机号码。在十五分钟内，他们
不仅告诉了他密码，还附送上了账号名。当我们使用这位上级人员的特权账号远程登录并
攫取了所有我们想要的信息后，“游戏结束”，真的很快。

\section{特权账号的弱智密码}
我想，大多数人会认为，攻击者通过两到三次猜测获得特权账号的用户名和密码的机率是
天文数字\footnote{译者：应该指非常小。}。

令人遗憾的是，这与真相大相径庭。侵入公司网络，从而获取公司信息，是极其容易的。
为什么？首先，人们普遍通过桌面环境访问系统（特别是~Windows）。其次，大多数人，
包括技术人员，似乎并不知道该如何选择足够安全的密码。

我们使用了如下的技术长达十年，它现在仍然能在~55\%~强的场合下给我们~Windows~网
络的管理员权限控制。想像一下，你是一个不满的雇员，或者也许是一个以清洁工或访客
的身份进入公司大楼的入侵者。如果此方法成功，你将能够在二十分钟以内完全控制公司
的~Windows~网络。

首先你将一台~Windows~笔记本电脑在任意位置接入网络\pzh可以在总部、支部或分店，
任何可信赖的第三方场所或者通过拨号连接都行。你使用~Windows~资源管理器浏览网络
并查看所有在网络中的~Windows~机器，没有必要登录或加入域来使之出现（或者如果你
是雇员或承包商的话，你当然也可以使用正当的桌面或笔记本电脑）。选择一台服务器（
他们通常以一个明显的风格命名）并试图发起一个“空会话”连接\pzh空会话是~Windows
NT~和~2000~的标准功能，它使你能够列出用户、组、组成员等等，而不需要任何形式的
认证。

互联网上有许多免费软件和授权软件能够帮你建立一个空会话并随后询问得到的信息。我
个人最喜欢的是~Hyena，一个为管理~Windows~网络设计的工具，但是许多邪恶的人会使
用~SNext~之类的免费工具来检查域账号锁定策略，使你得知账号被锁定（可能会抛出警
告）的时间以及在锁定之前你被允许尝试猜测密码的次数。

\begin{figure}[!bht]
	\begin{center}
		\epsfig{file= image001.eps, scale=0.6}
	\end{center}
	\caption{检查域账号锁定}
	\label{fig:netbios}
\end{figure}

现在列出管理员及域管理员组的用户，并寻找字符串模式，或者是模式的例外。通常，公
司对用户账号采用正式命名约定，即将姓和名或者首字母组合起来，例如~WOODP。令人遗
憾的是，当涉及到服务账号时，这些通常被忽略。服务账号是管理层的账号，用来允许应
用程序登录到服务器和域（应用程序如~Backupexec，Arcserve~和~Tivoli~是显然的例子
）。轮流选择每一个服务账号，并试图猜测它的密码。它并不像你想像的那么困难。

\begin{bigquote}
	当我们使用这位上级人员的特权账号远程登录后，‘游戏结束’，真的很快
\end{bigquote}

网络管理员经常选择一些明显的密码，例如以用户名作为密码！当然，网上有一长串默认
账号名和密码的列表可供尝试。注意在规定的时间段里你不能超过账号锁定阈值次尝试，
否则即使是最蹩脚的管理员也能猜到发生了什么。

如果这样失败的话，试试那些看起来像是共享管理员的账号或脚本创建的账号，如
~|Administrator|，|Install|，|AutoInstall|~或类似。至少在百分之五十的情况下，
你能得到域管理员权限，使你可以创建自己的管理员账号，正当地加入域，以及帮助自己
获得服务器上的任何信息。

\section{未受保护的底层设备}
还有一个鲜有公司认识和理解的侵入大型网络的后门：简单网络管理协议（SNMP）。
SNMP~是为了在~IP~网络中管理节点（服务器，工作站，路由器，交换机和集线器等等）
而制定的互联网标准协议。它同样是让人控制你的网络，偷取信息的窃听流量的最简单的
途径之一！

通常，SNMP~在路由器，交换机，有时甚至在服务器上默认启用。如果你使用网络管理软
件如~HP OpenView~或者~IBM Tivoli，那么你就在使用~SNMP。即使你什么网络管理软件
也没有用，SNMP~仍然存在于你的网络某处。

你需要知道两个密码（称为“社区字符串”）来利用~SNMP：一是读字符串，默认值为“
|public|”；一是读/写字符串，默认值为“|private|”。大多数人从未改变这些默认值。有
了这些知识的武装，你就能查看、修改或是远程控制许多开启~SNMP~功能的装置。

\begin{bigquote}
	涉及到服务账号时，正式命名约定通常被忽略
\end{bigquote}

当你接入网络时，DHCP~服务器通常会分配~IP~地址。同时你得到了“默认网关”的地址
，即路由器地址，你的电脑需要知道它才能访问其他的网络。在命令提示符下输入“
|ipconfig -all|”即可看到这些设置。如果你将默认网关的地址填入一个网络探查工具
如~SolarWinds Network Sonar，并且如果你的路由器是以默认方式设置，你很快会得到
你所处网络中每台设备的详细信息。

\begin{bigquote}
	至少在百分之五十的情况下，你能得到域管理员权限，使你可以创建自己的管理
	员账号……以及帮助自己获得服务器上的任何信息
\end{bigquote}

如果你知道了~SNMP~读/写字符串，你就能从每个路由器上下载其路由配置文件，并频繁
地读取管理员密码，从而使你拥有网络底层设备的控制权。

\begin{figure}[!bht]
	\begin{center}
		\epsfig{file= image002.eps, scale=0.6}
	\end{center}
	\caption{找出密码}
	\label{fig:teaseout}
\end{figure}

如果你发现有运行~SNMP~的~Windows~服务器（这很有可能），那么你就能列出那台服务
器上每个用户和组的名称，而不论你的“空会话”设置如何。如上所述，这是一个进行密
码猜测和字典攻击的极好的出发点。你同样可以映射出你的~Windows~域，发现服务器名
称，甚至看到使用的硬件类型。

\section{没有使用与没打补丁的服务}
在典型的~Windows~和~UNIX~服务器上运行的服务的庞大数目，足以打消缺少时间和资源
的网络管理员决定哪些是需要的和哪些是多余的的念头。因此有许多不同的方法来侵入一
个意料之外的安全的服务器或工作站。

\begin{bigquote}
	如果你发现有运行~SNMP~的~Windows~服务器，那么你就能列出那台服务
器上每个用户和组的名称，而不论你的‘空会话’设置如何
\end{bigquote}

例如，在~Compaq~和现在的~HP~服务器上，有一个有趣的服务叫做~Compaq~洞察管理器（
或更新的~HP~系统洞察管理器），它有可能被设置得很烂。常常可以在~TCP~端口~2301~%
找到访问该服务的网页界面。老的版本的默认管理员密码是“|administrator|”，允许
未经授权的用户来获得服务器远程控制，读取~SNMP~字符串（并由此忽视任何你所做的
~SNMP~的强化），甚至关闭服务器的电源。

\begin{figure}[!bht]
	\begin{center}
		\epsfig{file= image004.eps, scale=0.6}
	\end{center}
	\caption{有漏洞的未打补丁的~Windows~系统}
	\label{fig:unpatched}
\end{figure}

许多安装了~Windows 2000~的系统也默认安装了互联网信息服务器（IIS）。因为在大型
公司网络中对每个~Windows~系统打补丁是个巨大的费劲的差事，因此打补丁的焦点往往
在面向互联网的服务器上，也有可能包括内部的服务器。这使得未打补丁的桌面电脑在
~IIS~数目庞大的漏洞面前脆弱不堪。IIS~的漏洞使得攻击者能够获得管理员权限，从而
能够安装木马，并收集他们所需要的信息。

在我们所测试的许多站点中，我们发现了运行~UNIX~操作系统的商业系统，而公司内部大
多数的技术专业知识是在~Windows~系统上。因此这些~UNIX~系统有时是被提供商业应用
程序的第三方远程管理，而不幸的是他们并不总是积极地安装最新的补丁或强化操作系统
的配置文件。这导致了各种各样的老版本服务都有成熟的漏洞，通常是在运行财务程序的
商业关键系统中。

\section{未受保护的笔记本电脑}
随着如此之多的员工每星期有一两天在家工作，并且每个人都想从世界的任何角落联网，
笔记本电脑成为了重要的工具。几乎每一个公司都有一个~VPN~来给员工通过互联网远程
访问权限，但也有极少数认识到了笔记本电脑带来了多大的风险。如果攻击者能够获得一
个丢失的或被盗的笔记本电脑的控制权，他们就能够访问它所储存的所有信息，以及通过
~VPN~连接公司网络的良机。

我们时不时地被要求来测试笔记本系统的安全性（也许那个公司正准备转移到新的
~Windows~版本或仅仅是开发了一个新的“笔记本系统”），每次我们都被要求测试他们
的标准笔记本电脑配置文件。我们首先检查的是~BIOS~密码的存在与否。这给可能的攻击
者造成了一小点困难，它通常可以通过在主板上搞点鬼或者取下硬盘放到其他系统上来简
单地克服。

\begin{bigquote}
	各种各样的老版本服务都有成熟的漏洞，通常是在运行财务程序的商业关键系统
	中
\end{bigquote}

硬盘密码是另一个问题，它通常需要专家帮助，同时也因此被认为更加有效。除非是，硬
盘密码和~BIOS~密码相同，此时问题就解决了。然而，我们尚未找到使用任何一种形式的
开机密码的公司用笔记本电脑，也许是因为忘记密码造成的预期支持成本太高！

\begin{bigquote}
	硬盘密码通常需要专家帮助，同时也因此被认为更加有效
\end{bigquote}

假设没有~BIOS~密码，我们所需要的也就是~Windows~的用户名和密码。由于我们拥有对
机器的物理访问权，那就很好办了。诸如~Peter Nordahl-Hagen~的~Offline NT
Password and Registry Editor~在网上免费可得。该软件创建一张启动光盘或软盘，它
在根本不需要启动~Windows~的情况下重置管理员密码。一旦完成，你就能重启笔记本电
脑并以管理员身份登录，拥有对一切东西的完全访问权，当然包括任何拨号或~VPN~连接
。然而，如果你的笔记本电脑主人使用了随~XP~附带的微软的加密文件系统（EFS），那
你将不能恢复这些文件，那可是非常恼人的！

另一个可行的方法是使用类似~NTFS Reader for DOS~的程序，来制作含有用户名和密码
的~Windows SAM~文件的拷贝，同样不需要运行~Windows。一旦你得到了~SAM~文件的拷贝
，你就能运行一个密码破解程序来寻找笔记本电脑上所有的密码，然后以管理员的正当资
格登录。

\begin{figure}[!bht]
	\begin{center}
		\epsfig{file= image005.eps, scale=0.6}
	\end{center}
	\caption{做一个~Windows SAM~文件的拷贝}
	\label{fig:samcopy}
\end{figure}

\begin{bigquote}
	破解密码的一个必胜的方法是使用诸如~Cain~和~Abel~之类的工具操作彩虹表。
\end{bigquote}

这需要花费更多的时间但是不会留下篡改的痕迹，并保持了~EFS~文件原封不动。如果你
感到好奇的话，破解密码的一个必胜的方法是使用诸如~Cain~和~Abel~之类的工具操作彩
虹表。彩虹表是预先计算的密码哈希表，对应了几乎所有最多~14~个字符长度的以字母、
数字和标点字符组成的密码的组合，它使找出密码成为时间问题。虽然它们很大（大到好
几~GB），Windows~彩虹表可以从互联网上免费下载得到或通过在线购买一系列的~CD~或
~DVD。

\section*{一些解决方法}
\addcontentsline{toc}{section}{一些解决方法}
贯穿这篇文章的共同主题似乎是安全意识的缺乏。我的“五大”弱点可以通过一些好的、
聪明的策略以及对职员，特别是~IT~职员的合理教育来减轻影响。

\begin{itemize}
	\item 如果禁止接待员给出职员成员的信息，给予服务台员工对于如何证实密码
		重置的请求以清晰的指引，那么我在~No.\@ 1 --- 乐于助人的职员中
		描述的电话社会工程学之类会立马失败。
	\item 对设定服务账号和如何选择高质量的、易于记住的密码进行清晰的指导能
		够消除~No.\@ 2 --- 特权账号的弱智密码。对于~Windows~密码如何工
		作的一些技术上的理解同样能够帮助~IT~职员选择更高质量的密码。
	\item 一个网络发掘演练能够对于你的网络脆弱性和网络团队的治疗方案给出有
		价值的信息。理解这些以及其他默认底层设备如何提供到你的网络的不
		受限制的访问是在与黑客和内部人员的斗争中的主要武器。通过为你使
		用一些不贵的工具或者雇佣人员来进行一次网络发掘演练，这回答了
		~No.\@ 3 --- 未受保护的底层设备。
	\item No.\@ 4 --- 没有使用与没打补丁的服务能通过有选择地和小心地使用众
		多常见可得的弱点扫描器找出。Nessus~仍然是最受欢迎的免费扫描器
		之一，它能给你你的网络漏洞的概览。另外可靠的方法是，偶尔访问第
		三方来进行一次脆弱性评估和渗透。
	\item 对于~No.\@ 5 --- 未受保护的笔记本电脑，有一个简单的解决方法：加
		密。这给笔记本电脑用户带来了通过一个易于记住的密码词组（比一个
		复杂的密码更加易于管理和记住）保护所有东西的容易性，同时向
		~IT~服务人员提供了一个在用户的密码词组忘记或该职员成员一不高兴
		离开公司时正当地进入笔记本电脑的“后门”。像~PGP's Whole Disk
		Encryption for Enterprises~之类的产品能锁住笔记本电脑、桌面电
		脑、外接硬盘或~USB~闪盘上的全部内容，包括启动扇区，系统文件和
		交换文件。加密作为一个后台进程运行，对用户透明，它自动地保护有
		价值的数据，而不需要用户执行额外的步骤。
\end{itemize}

最后，我得重申，高质量的策略、对职员合适的教育以及管理上的规定共同支撑了上面各
点。没有这些，好的打算会迅速陷入无用的境地，标准也会使人成为在日复一日的压力要
求下的受害者。

\vfil
\begin{center}
	翻译完毕。\\
	译者：尹甸\qquad\qquad PB04000837
\end{center}

\end{document}
